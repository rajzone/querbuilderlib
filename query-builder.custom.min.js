!function(e,t){"function"==typeof define&&define.amd?define("jQuery.extendext",["jquery"],t):t(e.jQuery)}(this,function(e){"use strict";e.extendext=function(){var t,r,i,n,o,l,s=arguments[0]||{},a=1,u=arguments.length,p=!1,d="default";for("boolean"==typeof s&&(p=s,s=arguments[a++]||{}),"string"==typeof s&&(d=e([s.toLowerCase(),"default"]).filter(["default","concat","replace","extend"])[0],s=arguments[a++]||{}),"object"==typeof s||e.isFunction(s)||(s={}),a===u&&(s=this,a--);u>a;a++)if(null!==(t=arguments[a]))if(e.isArray(t)&&"default"!==d)switch(l=s&&e.isArray(s)?s:[],d){case"concat":s=l.concat(e.extend(p,[],t));break;case"replace":s=e.extend(p,[],t);break;case"extend":t.forEach(function(t,r){if("object"==typeof t){var i=e.isArray(t)?[]:{};l[r]=e.extendext(p,d,l[r]||i,t)}else-1===l.indexOf(t)&&l.push(t)}),s=l}else for(r in t)i=s[r],s!==(n=t[r])&&(p&&n&&(e.isPlainObject(n)||(o=e.isArray(n)))?(o?(o=!1,l=i&&e.isArray(i)?i:[]):l=i&&e.isPlainObject(i)?i:{},s[r]=e.extendext(p,d,l,n)):void 0!==n&&(s[r]=n));return s}}),function(){"use strict";function e(e){return e.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var t,r={version:"1.0.3",templateSettings:{evaluate:/\{\{([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1,doNotSkipEncoded:!1},template:void 0,compile:void 0,encodeHTMLSource:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},r=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return e?e.toString().replace(r,function(e){return t[e]||e}):""}}};t=function(){return this||(0,eval)("this")}(),"undefined"!=typeof module&&module.exports?module.exports=r:"function"==typeof define&&define.amd?define("doT",function(){return r}):t.doT=r;var i={append:{start:"'+(",end:")+'",startencode:"'+encodeHTML("},split:{start:"';out+=(",end:");out+='",startencode:"';out+=encodeHTML("}},n=/$^/;r.template=function(o,l,s){var a,u,p=(l=l||r.templateSettings).append?i.append:i.split,d=0,c=l.use||l.define?function e(t,r,i){return("string"==typeof r?r:r.toString()).replace(t.define||n,function(e,r,n,o){return 0===r.indexOf("def.")&&(r=r.substring(4)),r in i||(":"===n?(t.defineParams&&o.replace(t.defineParams,function(e,t,n){i[r]={arg:t,text:n}}),r in i||(i[r]=o)):new Function("def","def['"+r+"']="+o)(i)),""}).replace(t.use||n,function(r,n){t.useParams&&(n=n.replace(t.useParams,function(e,t,r,n){if(i[r]&&i[r].arg&&n){var o=(r+":"+n).replace(/'|\\/g,"_");return i.__exp=i.__exp||{},i.__exp[o]=i[r].text.replace(new RegExp("(^|[^\\w$])"+i[r].arg+"([^\\w$])","g"),"$1"+n+"$2"),t+"def.__exp['"+o+"']"}}));var o=new Function("def","return "+n)(i);return o?e(t,o,i):o})}(l,o,s||{}):o;c=("var out='"+(l.strip?c.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):c).replace(/'|\\/g,"\\$&").replace(l.interpolate||n,function(t,r){return p.start+e(r)+p.end}).replace(l.encode||n,function(t,r){return a=!0,p.startencode+e(r)+p.end}).replace(l.conditional||n,function(t,r,i){return r?i?"';}else if("+e(i)+"){out+='":"';}else{out+='":i?"';if("+e(i)+"){out+='":"';}out+='"}).replace(l.iterate||n,function(t,r,i,n){return r?(d+=1,u=n||"i"+d,r=e(r),"';var arr"+d+"="+r+";if(arr"+d+"){var "+i+","+u+"=-1,l"+d+"=arr"+d+".length-1;while("+u+"<l"+d+"){"+i+"=arr"+d+"["+u+"+=1];out+='"):"';} } out+='"}).replace(l.evaluate||n,function(t,r){return"';"+e(r)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,""),a&&(l.selfcontained||!t||t._encodeHTML||(t._encodeHTML=r.encodeHTMLSource(l.doNotSkipEncoded)),c="var encodeHTML = typeof _encodeHTML !== 'undefined' ? _encodeHTML : ("+r.encodeHTMLSource.toString()+"("+(l.doNotSkipEncoded||"")+"));"+c);try{return new Function(l.varname,c)}catch(e){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+c),e}},r.compile=function(e,t){return r.template(e,null,t)}}(),function(e,t){"function"==typeof define&&define.amd?define("query-builder",["jquery","doT","jQuery.extendext"],t):t(e.jQuery,e.doT)}(this,function(e,t){"use strict";function r(t){return this instanceof r?(this.root=null,void(this.$=e(this))):r.getModel(t)}function i(t,r){r.forEach(function(r){Object.defineProperty(t.prototype,r,{enumerable:!0,get:function(){return this.__[r]},set:function(t){var i=null!==this.__[r]&&"object"==typeof this.__[r]?e.extend({},this.__[r]):this.__[r];this.__[r]=t,null!==this.model&&this.model.trigger("update",this,r,t,i)}})})}function n(e,t){var i;return(i=t.closest(l.rule_container)).length?void e.moveAfter(r(i)):(i=t.closest(l.group_header)).length?(i=t.closest(l.group_container),void e.moveAtBegin(r(i))):(i=t.closest(l.group_container)).length?void e.moveAtEnd(r(i)):void 0}var o=function(e,t){this.init(e,t)};e.extend(o.prototype,{change:function(t,r){var i=new e.Event(t+".queryBuilder.filter",{builder:this,value:r});return this.$el.triggerHandler(i,Array.prototype.slice.call(arguments,2)),i.value},trigger:function(t){var r=new e.Event(t+".queryBuilder",{builder:this});return this.$el.triggerHandler(r,Array.prototype.slice.call(arguments,1)),r},on:function(e,t){return this.$el.on(e+".queryBuilder",t),this},off:function(e,t){return this.$el.off(e+".queryBuilder",t),this},once:function(e,t){return this.$el.one(e+".queryBuilder",t),this}}),o.plugins={},o.defaults=function(t){return"object"!=typeof t?"string"==typeof t?"object"==typeof o.DEFAULTS[t]?e.extend(!0,{},o.DEFAULTS[t]):o.DEFAULTS[t]:e.extend(!0,{},o.DEFAULTS):void e.extendext(!0,"replace",o.DEFAULTS,t)},o.define=function(e,t,r){o.plugins[e]={fct:t,def:r||{}}},o.extend=function(t){e.extend(o.prototype,t)},o.prototype.initPlugins=function(){if(this.plugins){if(e.isArray(this.plugins)){var t={};this.plugins.forEach(function(e){t[e]=null}),this.plugins=t}Object.keys(this.plugins).forEach(function(t){t in o.plugins?(this.plugins[t]=e.extend(!0,{},o.plugins[t].def,this.plugins[t]||{}),o.plugins[t].fct.call(this,this.plugins[t])):p.error("Config",'Unable to find plugin "{0}"',t)},this)}},o.types={string:"string",integer:"number",double:"number",date:"datetime",time:"datetime",datetime:"datetime",boolean:"boolean"},o.inputs=["text","textarea","radio","checkbox","select"],o.modifiable_options=["display_errors","allow_groups","allow_empty","default_condition","default_filter"];var l=o.selectors={group_container:".rules-group-container",rule_container:".rule-container",filter_container:".rule-filter-container",operator_container:".rule-operator-container",value_container:".rule-value-container",error_container:".error-container",condition_container:".rules-group-header .group-conditions",rule_header:".rule-header",group_header:".rules-group-header",group_actions:".group-actions",rule_actions:".rule-actions",rules_list:".rules-group-body>.rules-list",group_condition:".rules-group-header [name$=_cond]",rule_filter:".rule-filter-container [name$=_filter]",rule_operator:".rule-operator-container [name$=_operator]",rule_value:".rule-value-container [name*=_value_]",add_rule:"[data-add=rule]",delete_rule:"[data-delete=rule]",add_group:"[data-add=group]",delete_group:"[data-delete=group]"};o.templates={},o.regional={},o.OPERATORS={equal:{type:"equal",nb_inputs:1,multiple:!1,apply_to:["string","number","datetime","boolean"]},not_equal:{type:"not_equal",nb_inputs:1,multiple:!1,apply_to:["string","number","datetime","boolean"]},in:{type:"in",nb_inputs:1,multiple:!0,apply_to:["string","number","datetime"]},not_in:{type:"not_in",nb_inputs:1,multiple:!0,apply_to:["string","number","datetime"]},less:{type:"less",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},less_or_equal:{type:"less_or_equal",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},greater:{type:"greater",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},greater_or_equal:{type:"greater_or_equal",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},between:{type:"between",nb_inputs:2,multiple:!1,apply_to:["number","datetime"]},not_between:{type:"not_between",nb_inputs:2,multiple:!1,apply_to:["number","datetime"]},begins_with:{type:"begins_with",nb_inputs:1,multiple:!1,apply_to:["string"]},not_begins_with:{type:"not_begins_with",nb_inputs:1,multiple:!1,apply_to:["string"]},contains:{type:"contains",nb_inputs:1,multiple:!1,apply_to:["string"]},not_contains:{type:"not_contains",nb_inputs:1,multiple:!1,apply_to:["string"]},ends_with:{type:"ends_with",nb_inputs:1,multiple:!1,apply_to:["string"]},not_ends_with:{type:"not_ends_with",nb_inputs:1,multiple:!1,apply_to:["string"]},is_empty:{type:"is_empty",nb_inputs:0,multiple:!1,apply_to:["string"]},is_not_empty:{type:"is_not_empty",nb_inputs:0,multiple:!1,apply_to:["string"]},is_null:{type:"is_null",nb_inputs:0,multiple:!1,apply_to:["string","number","datetime","boolean"]},is_not_null:{type:"is_not_null",nb_inputs:0,multiple:!1,apply_to:["string","number","datetime","boolean"]}},o.DEFAULTS={filters:[],plugins:[],sort_filters:!1,display_errors:!0,allow_groups:-1,allow_empty:!1,conditions:["AND","OR"],default_condition:"AND",inputs_separator:" , ",select_placeholder:"------",display_empty_filter:!0,default_filter:null,optgroups:{},default_rule_flags:{filter_readonly:!1,operator_readonly:!1,value_readonly:!1,no_delete:!1},default_group_flags:{condition_readonly:!1,no_delete:!1},templates:{group:null,rule:null,filterSelect:null,operatorSelect:null},lang_code:"en",lang:{},operators:["equal","not_equal","in","not_in","less","less_or_equal","greater","greater_or_equal","between","not_between","begins_with","not_begins_with","contains","not_contains","ends_with","not_ends_with","is_empty","is_not_empty","is_null","is_not_null"],icons:{add_group:"glyphicon glyphicon-plus-sign",add_rule:"glyphicon glyphicon-plus",remove_group:"glyphicon glyphicon-remove",remove_rule:"glyphicon glyphicon-remove",error:"glyphicon glyphicon-warning-sign"}},o.prototype.init=function(i,n){i[0].queryBuilder=this,this.$el=i,this.settings=e.extendext(!0,"replace",{},o.DEFAULTS,n),this.model=new r,this.status={group_id:0,rule_id:0,generated_id:!1,has_optgroup:!1,has_operator_oprgroup:!1,id:null,updating_value:!1},!1===this.settings.allow_groups?this.settings.allow_groups=0:!0===this.settings.allow_groups&&(this.settings.allow_groups=-1),this.filters=this.settings.filters,this.icons=this.settings.icons,this.operators=this.settings.operators,this.templates=this.settings.templates,this.plugins=this.settings.plugins,void 0===o.regional.en&&p.error("Config",'"i18n/en.js" not loaded.'),this.lang=e.extendext(!0,"replace",{},o.regional.en,o.regional[this.settings.lang_code],this.settings.lang),Object.keys(this.templates).forEach(function(e){this.templates[e]||(this.templates[e]=o.templates[e]),"string"==typeof this.templates[e]&&(this.templates[e]=t.template(this.templates[e]))},this),this.$el.attr("id")||(this.$el.attr("id","qb_"+Math.floor(99999*Math.random())),this.status.generated_id=!0),this.status.id=this.$el.attr("id"),this.$el.addClass("query-builder form-inline"),this.filters=this.checkFilters(this.filters),this.operators=this.checkOperators(this.operators),this.bindEvents(),this.initPlugins(),this.trigger("afterInit"),n.rules?(this.setRules(n.rules),delete this.settings.rules):this.setRoot(!0)},o.prototype.checkFilters=function(e){var t=[];if(e&&0!==e.length||p.error("Config","Missing filters list"),e.forEach(function(e,r){switch(e.id||p.error("Config","Missing filter {0} id",r),-1!=t.indexOf(e.id)&&p.error("Config",'Filter "{0}" already defined',e.id),t.push(e.id),e.type?o.types[e.type]||p.error("Config",'Invalid type "{0}"',e.type):e.type="string",e.input?"function"!=typeof e.input&&-1==o.inputs.indexOf(e.input)&&p.error("Config",'Invalid input "{0}"',e.input):e.input="text",e.operators&&e.operators.forEach(function(e){"string"!=typeof e&&p.error("Config","Filter operators must be global operators types (string)")}),e.field||(e.field=e.id),e.label||(e.label=e.field),e.optgroup?(this.status.has_optgroup=!0,this.settings.optgroups[e.optgroup]||(this.settings.optgroups[e.optgroup]=e.optgroup)):e.optgroup=null,e.input){case"radio":case"checkbox":(!e.values||e.values.length<1)&&p.error("Config",'Missing filter "{0}" values',e.id);break;case"select":e.placeholder&&(void 0===e.placeholder_value&&(e.placeholder_value=-1),p.iterateOptions(e.values,function(t){t==e.placeholder_value&&p.error("Config",'Placeholder of filter "{0}" overlaps with one of its values',e.id)}))}},this),this.settings.sort_filters)if("function"==typeof this.settings.sort_filters)e.sort(this.settings.sort_filters);else{var r=this;e.sort(function(e,t){return r.translateLabel(e.label).localeCompare(r.translateLabel(t.label))})}return this.status.has_optgroup&&(e=p.groupSort(e,"optgroup")),e},o.prototype.checkOperators=function(t){var r=[];return t.forEach(function(i,n){"string"==typeof i?(o.OPERATORS[i]||p.error("Config",'Unknown operator "{0}"',i),t[n]=i=e.extendext(!0,"replace",{},o.OPERATORS[i])):(i.type||p.error("Config",'Missing "type" for operator {0}',n),o.OPERATORS[i.type]&&(t[n]=i=e.extendext(!0,"replace",{},o.OPERATORS[i.type],i)),void 0!==i.nb_inputs&&void 0!==i.apply_to||p.error("Config",'Missing "nb_inputs" and/or "apply_to" for operator "{0}"',i.type)),-1!=r.indexOf(i.type)&&p.error("Config",'Operator "{0}" already defined',i.type),r.push(i.type),i.optgroup?(this.status.has_operator_optgroup=!0,this.settings.optgroups[i.optgroup]||(this.settings.optgroups[i.optgroup]=i.optgroup)):i.optgroup=null},this),this.status.has_operator_optgroup&&(t=p.groupSort(t,"optgroup")),t},o.prototype.bindEvents=function(){var t=this;this.$el.on("change.queryBuilder",l.group_condition,function(){e(this).is(":checked")&&(r(e(this).closest(l.group_container)).condition=e(this).val())}),this.$el.on("change.queryBuilder",l.rule_filter,function(){r(e(this).closest(l.rule_container)).filter=t.getFilterById(e(this).val())}),this.$el.on("change.queryBuilder",l.rule_operator,function(){r(e(this).closest(l.rule_container)).operator=t.getOperatorByType(e(this).val())}),this.$el.on("click.queryBuilder",l.add_rule,function(){var i=e(this).closest(l.group_container);t.addRule(r(i))}),this.$el.on("click.queryBuilder",l.delete_rule,function(){var i=e(this).closest(l.rule_container);t.deleteRule(r(i))}),0!==this.settings.allow_groups&&(this.$el.on("click.queryBuilder",l.add_group,function(){var i=e(this).closest(l.group_container);t.addGroup(r(i))}),this.$el.on("click.queryBuilder",l.delete_group,function(){var i=e(this).closest(l.group_container);t.deleteGroup(r(i))})),this.model.on({drop:function(e,r){r.$el.remove(),t.refreshGroupsConditions()},add:function(e,r,i){0===i?r.$el.prependTo(r.parent.$el.find(">"+l.rules_list)):r.$el.insertAfter(r.parent.rules[i-1].$el),t.refreshGroupsConditions()},move:function(e,r,i,n){r.$el.detach(),0===n?r.$el.prependTo(i.$el.find(">"+l.rules_list)):r.$el.insertAfter(i.rules[n-1].$el),t.refreshGroupsConditions()},update:function(e,r,i,n,o){if(r instanceof u)switch(i){case"error":t.displayError(r);break;case"flags":t.applyRuleFlags(r);break;case"filter":t.updateRuleFilter(r);break;case"operator":t.updateRuleOperator(r,o);break;case"value":t.updateRuleValue(r)}else switch(i){case"error":t.displayError(r);break;case"flags":t.applyGroupFlags(r);break;case"condition":t.updateGroupCondition(r)}}})},o.prototype.setRoot=function(t,r,i){t=void 0===t||!0===t;var n=this.nextGroupId(),o=e(this.getGroupTemplate(n,1));return this.$el.append(o),this.model.root=new a(null,o),this.model.root.model=this.model,this.model.root.data=r,this.model.root.flags=e.extend({},this.settings.default_group_flags,i),this.trigger("afterAddGroup",this.model.root),this.model.root.condition=this.settings.default_condition,t&&this.addRule(this.model.root),this.model.root},o.prototype.addGroup=function(t,r,i,n){r=void 0===r||!0===r;var o=t.level+1;if(this.trigger("beforeAddGroup",t,r,o).isDefaultPrevented())return null;var l=this.nextGroupId(),s=e(this.getGroupTemplate(l,o)),a=t.addGroup(s);return a.data=i,a.flags=e.extend({},this.settings.default_group_flags,n),this.trigger("afterAddGroup",a),a.condition=this.settings.default_condition,r&&this.addRule(a),a},o.prototype.deleteGroup=function(e){if(e.isRoot())return!1;if(this.trigger("beforeDeleteGroup",e).isDefaultPrevented())return!1;var t=!0;return e.each("reverse",function(e){t&=this.deleteRule(e)},function(e){t&=this.deleteGroup(e)},this),t&&(e.drop(),this.trigger("afterDeleteGroup")),t},o.prototype.updateGroupCondition=function(t){t.$el.find(">"+l.group_condition).each(function(){var r=e(this);r.prop("checked",r.val()===t.condition),r.parent().toggleClass("active",r.val()===t.condition)}),this.trigger("afterUpdateGroupCondition",t)},o.prototype.refreshGroupsConditions=function(){!function e(t){(!t.flags||t.flags&&!t.flags.condition_readonly)&&t.$el.find(">"+l.group_condition).prop("disabled",t.rules.length<=1).parent().toggleClass("disabled",t.rules.length<=1),t.each(function(e){},function(t){e(t)},this)}(this.model.root)},o.prototype.addRule=function(t,r,i){if(this.trigger("beforeAddRule",t).isDefaultPrevented())return null;var n=this.nextRuleId(),o=e(this.getRuleTemplate(n)),l=t.addRule(o);return void 0!==r&&(l.data=r),l.flags=e.extend({},this.settings.default_rule_flags,i),this.trigger("afterAddRule",l),this.createRuleFilters(l),!this.settings.default_filter&&this.settings.display_empty_filter||(l.filter=this.getFilterById(this.settings.default_filter||this.filters[0].id)),l},o.prototype.deleteRule=function(e){return!e.flags.no_delete&&(!this.trigger("beforeDeleteRule",e).isDefaultPrevented()&&(e.drop(),this.trigger("afterDeleteRule"),!0))},o.prototype.createRuleFilters=function(t){var r=this.change("getRuleFilters",this.filters,t),i=e(this.getRuleFilterSelect(t,r));t.$el.find(l.filter_container).html(i),this.trigger("afterCreateRuleFilters",t)},o.prototype.createRuleOperators=function(t){var r=t.$el.find(l.operator_container).empty();if(t.filter){var i=this.getOperators(t.filter),n=e(this.getRuleOperatorSelect(t,i));r.html(n),t.__.operator=i[0],this.trigger("afterCreateRuleOperators",t,i)}},o.prototype.createRuleInput=function(t){var r=t.$el.find(l.value_container).empty();if(t.__.value=void 0,t.filter&&t.operator&&0!==t.operator.nb_inputs){for(var i=this,n=e(),o=t.filter,s=0;s<t.operator.nb_inputs;s++){var a=e(this.getRuleInput(t,s));s>0&&r.append(this.settings.inputs_separator),r.append(a),n=n.add(a)}r.show(),n.on("change "+(o.input_event||""),function(){i.status.updating_value=!0,t.value=i.getRuleValue(t),i.status.updating_value=!1}),o.plugin&&n[o.plugin](o.plugin_config||{}),this.trigger("afterCreateRuleInput",t),void 0!==o.default_value?t.value=o.default_value:(i.status.updating_value=!0,t.value=i.getRuleValue(t),i.status.updating_value=!1)}},o.prototype.updateRuleFilter=function(e){this.createRuleOperators(e),this.createRuleInput(e),e.$el.find(l.rule_filter).val(e.filter?e.filter.id:"-1"),this.trigger("afterUpdateRuleFilter",e)},o.prototype.updateRuleOperator=function(e,t){var r=e.$el.find(l.value_container);e.operator&&0!==e.operator.nb_inputs?(r.show(),(r.is(":empty")||e.operator.nb_inputs!==t.nb_inputs)&&this.createRuleInput(e)):(r.hide(),e.__.value=void 0),e.operator&&e.$el.find(l.rule_operator).val(e.operator.type),this.trigger("afterUpdateRuleOperator",e)},o.prototype.updateRuleValue=function(e){this.status.updating_value||this.setRuleValue(e,e.value),this.trigger("afterUpdateRuleValue",e)},o.prototype.applyRuleFlags=function(e){var t=e.flags;t.filter_readonly&&e.$el.find(l.rule_filter).prop("disabled",!0),t.operator_readonly&&e.$el.find(l.rule_operator).prop("disabled",!0),t.value_readonly&&e.$el.find(l.rule_value).prop("disabled",!0),t.no_delete&&e.$el.find(l.delete_rule).remove(),this.trigger("afterApplyRuleFlags",e)},o.prototype.applyGroupFlags=function(e){var t=e.flags;t.condition_readonly&&e.$el.find(">"+l.group_condition).prop("disabled",!0).parent().addClass("readonly"),t.no_delete&&e.$el.find(l.delete_group).remove(),this.trigger("afterApplyGroupFlags",e)},o.prototype.clearErrors=function(e){(e=e||this.model.root)&&(e.error=null,e instanceof a&&e.each(function(e){e.error=null},function(e){this.clearErrors(e)},this))},o.prototype.displayError=function(t){if(this.settings.display_errors)if(null===t.error)t.$el.removeClass("has-error");else{var r=e.extend([],t.error,[this.lang.errors[t.error[0]]||t.error[0]]);t.$el.addClass("has-error").find(l.error_container).eq(0).attr("title",p.fmt.apply(null,r))}},o.prototype.triggerValidationError=function(t,r,i){e.isArray(r)||(r=[r]),this.trigger("validationError",t,r,i).isDefaultPrevented()||(t.error=r)},o.prototype.destroy=function(){this.trigger("beforeDestroy"),this.status.generated_id&&this.$el.removeAttr("id"),this.clear(),this.model=null,this.$el.off(".queryBuilder").removeClass("query-builder").removeData("queryBuilder"),delete this.$el[0].queryBuilder},o.prototype.reset=function(){this.status.group_id=1,this.status.rule_id=0,this.model.root.empty(),this.addRule(this.model.root),this.trigger("afterReset")},o.prototype.clear=function(){this.status.group_id=0,this.status.rule_id=0,this.model.root&&(this.model.root.drop(),this.model.root=null),this.trigger("afterClear")},o.prototype.setOptions=function(t){e.makeArray(e(Object.keys(t)).filter(o.modifiable_options)).forEach(function(e){this.settings[e]=t[e]},this)},o.prototype.getModel=function(e){return e?r(e):this.model.root},o.prototype.validate=function(){this.clearErrors();var e=this,t=function t(r){var i=0,n=0;return r.each(function(t){if(!t.filter)return e.triggerValidationError(t,"no_filter",null),void n++;if(0!==t.operator.nb_inputs){var r=e.validateValue(t,t.value);if(!0!==r)return e.triggerValidationError(t,r,t.value),void n++}i++},function(e){t(e)?i++:n++}),!(n>0)&&(!!(0!==i||e.settings.allow_empty&&r.isRoot())||(e.triggerValidationError(r,"empty_group",null),!1))}(this.model.root);return this.change("validate",t)},o.prototype.getRules=function(t){if(t=e.extend({get_flags:!1},t),!this.validate())return{};var r=this,i=function i(n){var o={condition:n.condition,rules:[]};if(n.data&&(o.data=e.extendext(!0,"replace",{},n.data)),t.get_flags){var l=r.getGroupFlags(n.flags,"all"===t.get_flags);e.isEmptyObject(l)||(o.flags=l)}return n.each(function(i){var n=null;0!==i.operator.nb_inputs&&(n=i.value);var l={id:i.filter.id,field:i.filter.field,type:i.filter.type,input:i.filter.input,operator:i.operator.type,value:n};if((i.filter.data||i.data)&&(l.data=e.extendext(!0,"replace",{},i.filter.data,i.data)),t.get_flags){var s=r.getRuleFlags(i.flags,"all"===t.get_flags);e.isEmptyObject(s)||(l.flags=s)}o.rules.push(l)},function(e){o.rules.push(i(e))}),o}(this.model.root);return this.change("getRules",i)},o.prototype.setRules=function(t){e.isArray(t)&&(t={condition:this.settings.default_condition,rules:t}),t&&t.rules&&(0!==t.rules.length||this.settings.allow_empty)||p.error("RulesParse","Incorrect data object passed"),this.clear(),this.setRoot(!1,t.data,this.parseGroupFlags(t)),t=this.change("setRules",t);var r=this;!function e(t,i){null!==i&&(void 0===t.condition?t.condition=r.settings.default_condition:-1==r.settings.conditions.indexOf(t.condition)&&p.error("UndefinedCondition",'Invalid condition "{0}"',t.condition),i.condition=t.condition,t.rules.forEach(function(t){var n;if(t.rules&&t.rules.length>0)if(-1!==r.settings.allow_groups&&r.settings.allow_groups<i.level)r.reset(),p.error("RulesParse","No more than {0} groups are allowed",r.settings.allow_groups);else{if(null===(n=r.addGroup(i,!1,t.data,r.parseGroupFlags(t))))return;e(t,n)}else{if(void 0===t.id&&p.error("RulesParse","Missing rule field id"),void 0===t.operator&&(t.operator="equal"),null===(n=r.addRule(i,t.data)))return;n.filter=r.getFilterById(t.id),n.operator=r.getOperatorByType(t.operator),n.flags=r.parseRuleFlags(t),0!==n.operator.nb_inputs&&void 0!==t.value&&(n.value=t.value)}}))}(t,this.model.root)},o.prototype.validateValue=function(e,t){var r,i=e.filter.validation||{};return r=i.callback?i.callback.call(this,t,e):this.validateValueInternal(e,t),this.change("validateValue",r,t,e)},o.prototype.validateValueInternal=function(e,t){var r,i=e.filter,n=e.operator,l=i.validation||{},s=!0;t=1===e.operator.nb_inputs?[t]:t;for(var a=0;a<n.nb_inputs;a++){switch(i.input){case"radio":if(void 0===t[a]){s=["radio_empty"];break}break;case"checkbox":if(void 0===t[a]||0===t[a].length){s=["checkbox_empty"];break}if(!n.multiple&&t[a].length>1){s=["operator_not_multiple",n.type];break}break;case"select":if(i.multiple){if(void 0===t[a]||0===t[a].length||i.placeholder&&t[a]==i.placeholder_value){s=["select_empty"];break}if(!n.multiple&&t[a].length>1){s=["operator_not_multiple",n.type];break}}else if(void 0===t[a]||i.placeholder&&t[a]==i.placeholder_value){s=["select_empty"];break}break;default:switch(o.types[i.type]){case"string":if(void 0===t[a]||0===t[a].length){s=["string_empty"];break}if(void 0!==l.min&&t[a].length<parseInt(l.min)){s=["string_exceed_min_length",l.min];break}if(void 0!==l.max&&t[a].length>parseInt(l.max)){s=["string_exceed_max_length",l.max];break}if(l.format&&("string"==typeof l.format&&(l.format=new RegExp(l.format)),!l.format.test(t[a]))){s=["string_invalid_format",l.format];break}break;case"number":if(void 0===t[a]||isNaN(t[a])){s=["number_nan"];break}if("integer"==i.type){if(parseInt(t[a])!=t[a]){s=["number_not_integer"];break}}else if(parseFloat(t[a])!=t[a]){s=["number_not_double"];break}if(void 0!==l.min&&t[a]<parseFloat(l.min)){s=["number_exceed_min",l.min];break}if(void 0!==l.max&&t[a]>parseFloat(l.max)){s=["number_exceed_max",l.max];break}if(void 0!==l.step&&"any"!==l.step){var u=(t[a]/l.step).toPrecision(14);if(parseInt(u)!=u){s=["number_wrong_step",l.step];break}}break;case"datetime":if(void 0===t[a]||0===t[a].length){s=["datetime_empty"];break}if(l.format){"moment"in window||p.error("MissingLibrary","MomentJS is required for Date/Time validation. Get it here http://momentjs.com");var d=moment(t[a],l.format);if(!d.isValid()){s=["datetime_invalid",l.format];break}if(l.min&&d<moment(l.min,l.format)){s=["datetime_exceed_min",l.min];break}if(l.max&&d>moment(l.max,l.format)){s=["datetime_exceed_max",l.max];break}}break;case"boolean":if("true"!==(r=t[a].trim().toLowerCase())&&"false"!==r&&"1"!==r&&"0"!==r&&1!==t[a]&&0!==t[a]){s=["boolean_not_valid"];break}}}if(!0!==s)break}return s},o.prototype.nextGroupId=function(){return this.status.id+"_group_"+this.status.group_id++},o.prototype.nextRuleId=function(){return this.status.id+"_rule_"+this.status.rule_id++},o.prototype.getOperators=function(e){"string"==typeof e&&(e=this.getFilterById(e));for(var t=[],r=0,i=this.operators.length;i>r;r++){if(e.operators){if(-1==e.operators.indexOf(this.operators[r].type))continue}else if(-1==this.operators[r].apply_to.indexOf(o.types[e.type]))continue;t.push(this.operators[r])}return e.operators&&t.sort(function(t,r){return e.operators.indexOf(t.type)-e.operators.indexOf(r.type)}),this.change("getOperators",t,e)},o.prototype.getFilterById=function(e){if("-1"==e)return null;for(var t=0,r=this.filters.length;r>t;t++)if(this.filters[t].id==e)return this.filters[t];p.error("UndefinedFilter",'Undefined filter "{0}"',e)},o.prototype.getOperatorByType=function(e){if("-1"==e)return null;for(var t=0,r=this.operators.length;r>t;t++)if(this.operators[t].type==e)return this.operators[t];p.error("UndefinedOperator",'Undefined operator "{0}"',e)},o.prototype.getRuleValue=function(t){var r=t.filter,i=t.operator,n=[];if(r.valueGetter)n=r.valueGetter.call(this,t);else{for(var o=t.$el.find(l.value_container),s=0;s<i.nb_inputs;s++){var a,u=p.escapeElementId(t.id+"_value_"+s);switch(r.input){case"radio":n.push(o.find("[name="+u+"]:checked").val());break;case"checkbox":a=[],o.find("[name="+u+"]:checked").each(function(){a.push(e(this).val())}),n.push(a);break;case"select":r.multiple?(a=[],o.find("[name="+u+"] option:selected").each(function(){a.push(e(this).val())}),n.push(a)):n.push(o.find("[name="+u+"] option:selected").val());break;default:n.push(o.find("[name="+u+"]").val())}}1===i.nb_inputs&&(n=n[0]),r.valueParser&&(n=r.valueParser.call(this,t,n))}return this.change("getRuleValue",n,t)},o.prototype.setRuleValue=function(t,r){var i=t.filter,n=t.operator;if(i.valueSetter)i.valueSetter.call(this,t,r);else{var o=t.$el.find(l.value_container);r=1==n.nb_inputs?[r]:r;for(var s=0;s<n.nb_inputs;s++){var a=p.escapeElementId(t.id+"_value_"+s);switch(i.input){case"radio":o.find("[name="+a+'][value="'+r[s]+'"]').prop("checked",!0).trigger("change");break;case"checkbox":e.isArray(r[s])||(r[s]=[r[s]]),r[s].forEach(function(e){o.find("[name="+a+'][value="'+e+'"]').prop("checked",!0).trigger("change")});break;default:o.find("[name="+a+"]").val(r[s]).trigger("change")}}}},o.prototype.parseRuleFlags=function(t){var r=e.extend({},this.settings.default_rule_flags);return t.readonly&&e.extend(r,{filter_readonly:!0,operator_readonly:!0,value_readonly:!0,no_delete:!0}),t.flags&&e.extend(r,t.flags),this.change("parseRuleFlags",r,t)},o.prototype.getRuleFlags=function(t,r){if(r)return e.extend({},t);var i={};return e.each(this.settings.default_rule_flags,function(e,r){t[e]!==r&&(i[e]=t[e])}),i},o.prototype.parseGroupFlags=function(t){var r=e.extend({},this.settings.default_group_flags);return t.readonly&&e.extend(r,{condition_readonly:!0,no_delete:!0}),t.flags&&e.extend(r,t.flags),this.change("parseGroupFlags",r,t)},o.prototype.getGroupFlags=function(t,r){if(r)return e.extend({},t);var i={};return e.each(this.settings.default_group_flags,function(e,r){t[e]!==r&&(i[e]=t[e])}),i},o.prototype.translateLabel=function(e){return"object"==typeof e?e[this.settings.lang_code]||e.en:e},o.templates.group='<dl id="{{= it.group_id }}" class="rules-group-container">   <dt class="rules-group-header">     <div class="btn-group pull-right group-actions">       <button type="button" class="btn btn-xs btn-success" data-add="rule">         <i class="{{= it.icons.add_rule }}"></i> {{= it.lang.add_rule }}       </button>       {{? it.settings.allow_groups===-1 || it.settings.allow_groups>=it.level }}         <button type="button" class="btn btn-xs btn-success" data-add="group">           <i class="{{= it.icons.add_group }}"></i> {{= it.lang.add_group }}         </button>       {{?}}       {{? it.level>1 }}         <button type="button" class="btn btn-xs btn-danger" data-delete="group">           <i class="{{= it.icons.remove_group }}"></i> {{= it.lang.delete_group }}         </button>       {{?}}     </div>     <div class="btn-group group-conditions">       {{~ it.conditions: condition }}         <label class="btn btn-xs btn-primary">           <input type="radio" name="{{= it.group_id }}_cond" value="{{= condition }}"> {{= it.lang.conditions[condition] || condition }}         </label>       {{~}}     </div>     {{? it.settings.display_errors }}       <div class="error-container"><i class="{{= it.icons.error }}"></i></div>     {{?}}   </dt>   <dd class=rules-group-body>     <ul class=rules-list></ul>   </dd> </dl>',o.templates.rule='<li id="{{= it.rule_id }}" class="rule-container">   <div class="rule-header">     <div class="btn-group pull-right rule-actions">       <button type="button" class="btn btn-xs btn-danger" data-delete="rule">         <i class="{{= it.icons.remove_rule }}"></i> {{= it.lang.delete_rule }}       </button>     </div>   </div>   {{? it.settings.display_errors }}     <div class="error-container"><i class="{{= it.icons.error }}"></i></div>   {{?}}   <div class="rule-filter-container"></div>   <div class="rule-operator-container"></div>   <div class="rule-value-container"></div> </li>',o.templates.filterSelect='{{ var optgroup = null; }} <select class="form-control" name="{{= it.rule.id }}_filter">   {{? it.settings.display_empty_filter }}     <option value="-1">{{= it.settings.select_placeholder }}</option>   {{?}}   {{~ it.filters: filter }}     {{? optgroup !== filter.optgroup }}       {{? optgroup !== null }}</optgroup>{{?}}       {{? (optgroup = filter.optgroup) !== null }}         <optgroup label="{{= it.translate(it.settings.optgroups[optgroup]) }}">       {{?}}     {{?}}     <option value="{{= filter.id }}">{{= it.translate(filter.label) }}</option>   {{~}}   {{? optgroup !== null }}</optgroup>{{?}} </select>',o.templates.operatorSelect='{{ var optgroup = null; }} <select class="form-control" name="{{= it.rule.id }}_operator">   {{~ it.operators: operator }}     {{? optgroup !== operator.optgroup }}       {{? optgroup !== null }}</optgroup>{{?}}       {{? (optgroup = operator.optgroup) !== null }}         <optgroup label="{{= it.translate(it.settings.optgroups[optgroup]) }}">       {{?}}     {{?}}     <option value="{{= operator.type }}">{{= it.lang.operators[operator.type] || operator.type }}</option>   {{~}}   {{? optgroup !== null }}</optgroup>{{?}} </select>',o.prototype.getGroupTemplate=function(e,t){var r=this.templates.group({builder:this,group_id:e,level:t,conditions:this.settings.conditions,icons:this.icons,lang:this.lang,settings:this.settings});return this.change("getGroupTemplate",r,t)},o.prototype.getRuleTemplate=function(e){var t=this.templates.rule({builder:this,rule_id:e,icons:this.icons,lang:this.lang,settings:this.settings});return this.change("getRuleTemplate",t)},o.prototype.getRuleFilterSelect=function(e,t){var r=this.templates.filterSelect({builder:this,rule:e,filters:t,icons:this.icons,lang:this.lang,settings:this.settings,translate:this.translateLabel});return this.change("getRuleFilterSelect",r,e)},o.prototype.getRuleOperatorSelect=function(e,t){var r=this.templates.operatorSelect({builder:this,rule:e,operators:t,icons:this.icons,lang:this.lang,settings:this.settings,translate:this.translateLabel});return this.change("getRuleOperatorSelect",r,e)},o.prototype.getRuleInput=function(e,t){var r=e.filter,i=e.filter.validation||{},n=e.id+"_value_"+t,l=r.vertical?" class=block":"",s="";if("function"==typeof r.input)s=r.input.call(this,e,n);else switch(r.input){case"radio":case"checkbox":p.iterateOptions(r.values,function(e,t){s+="<label"+l+'><input type="'+r.input+'" name="'+n+'" value="'+e+'"> '+t+"</label> "});break;case"select":s+='<select class="form-control" name="'+n+'"'+(r.multiple?" multiple":"")+">",r.placeholder&&(s+='<option value="'+r.placeholder_value+'" disabled selected>'+r.placeholder+"</option>"),p.iterateOptions(r.values,function(e,t){s+='<option value="'+e+'">'+t+"</option> "}),s+="</select>";break;case"textarea":s+='<textarea class="form-control" name="'+n+'"',r.size&&(s+=' cols="'+r.size+'"'),r.rows&&(s+=' rows="'+r.rows+'"'),void 0!==i.min&&(s+=' minlength="'+i.min+'"'),void 0!==i.max&&(s+=' maxlength="'+i.max+'"'),r.placeholder&&(s+=' placeholder="'+r.placeholder+'"'),s+="></textarea>";break;default:switch(o.types[r.type]){case"number":s+='<input class="form-control" type="number" name="'+n+'"',void 0!==i.step&&(s+=' step="'+i.step+'"'),void 0!==i.min&&(s+=' min="'+i.min+'"'),void 0!==i.max&&(s+=' max="'+i.max+'"'),r.placeholder&&(s+=' placeholder="'+r.placeholder+'"'),r.size&&(s+=' size="'+r.size+'"'),s+=">";break;default:s+='<input class="form-control" type="text" name="'+n+'"',r.placeholder&&(s+=' placeholder="'+r.placeholder+'"'),"string"===r.type&&void 0!==i.min&&(s+=' minlength="'+i.min+'"'),"string"===r.type&&void 0!==i.max&&(s+=' maxlength="'+i.max+'"'),r.size&&(s+=' size="'+r.size+'"'),s+=">"}}return this.change("getRuleInput",s,e,n)},e.extend(r.prototype,{trigger:function(e){return this.$.triggerHandler(e,Array.prototype.slice.call(arguments,1)),this},on:function(){return this.$.on.apply(this.$,Array.prototype.slice.call(arguments)),this},off:function(){return this.$.off.apply(this.$,Array.prototype.slice.call(arguments)),this},once:function(){return this.$.one.apply(this.$,Array.prototype.slice.call(arguments)),this}}),r.getModel=function(t){return t?t instanceof s?t:e(t).data("queryBuilderModel"):null};var s=function(e,t){return this instanceof s?(Object.defineProperty(this,"__",{value:{}}),t.data("queryBuilderModel",this),this.__.level=1,this.__.error=null,this.__.data=void 0,this.$el=t,this.id=t[0].id,this.model=null,void(this.parent=e)):new s};i(s,["level","error","data","flags"]),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){return this.__.parent},set:function(e){this.__.parent=e,this.level=null===e?1:e.level+1,this.model=null===e?null:e.model}}),s.prototype.isRoot=function(){return 1===this.level},s.prototype.getPos=function(){return this.isRoot()?-1:this.parent.getNodePos(this)},s.prototype.drop=function(){var e=this.model;this.isRoot()||this.parent._removeNode(this),null!==e&&e.trigger("drop",this)},s.prototype.moveAfter=function(e){return this.isRoot()?void 0:(this._move(e.parent,e.getPos()+1),this)},s.prototype.moveAtBegin=function(e){return this.isRoot()?void 0:(void 0===e&&(e=this.parent),this._move(e,0),this)},s.prototype.moveAtEnd=function(e){return this.isRoot()?void 0:(void 0===e&&(e=this.parent),this._move(e,e.length()-1),this)},s.prototype._move=function(e,t){this.parent._removeNode(this),e._appendNode(this,t,!1),null!==this.model&&this.model.trigger("move",this,e,t)};var a=function(e,t){return this instanceof a?(s.call(this,e,t),this.rules=[],void(this.__.condition=null)):new a(e,t)};a.prototype=Object.create(s.prototype),a.prototype.constructor=a,i(a,["condition"]),a.prototype.empty=function(){this.each("reverse",function(e){e.drop()},function(e){e.drop()})},a.prototype.drop=function(){this.empty(),s.prototype.drop.call(this)},a.prototype.length=function(){return this.rules.length},a.prototype._appendNode=function(e,t,r){return void 0===t&&(t=this.length()),this.rules.splice(t,0,e),e.parent=this,r&&null!==this.model&&this.model.trigger("add",e,t),e},a.prototype.addGroup=function(e,t){return this._appendNode(new a(this,e),t,!0)},a.prototype.addRule=function(e,t){return this._appendNode(new u(this,e),t,!0)},a.prototype._removeNode=function(e){var t=this.getNodePos(e);return-1!==t&&(e.parent=null,this.rules.splice(t,1)),this},a.prototype.getNodePos=function(e){return this.rules.indexOf(e)},a.prototype.each=function(e,t,r,i){"function"==typeof e&&(i=r,r=t,t=e,e=!1),i=void 0===i?null:i;for(var n=e?this.rules.length-1:0,o=e?0:this.rules.length-1,l=e?-1:1,s=!1;(e?n>=o:o>=n)&&(this.rules[n]instanceof a?void 0!==r&&(s=!1===r.call(i,this.rules[n])):s=!1===t.call(i,this.rules[n]),!s);n+=l);return!s},a.prototype.contains=function(e,t){return-1!==this.getNodePos(e)||!!t&&!this.each(function(e){return!0},function(t){return!t.contains(e,!0)})};var u=function(e,t){return this instanceof u?(s.call(this,e,t),this.__.filter=null,this.__.operator=null,this.__.flags={},void(this.__.value=void 0)):new u(e,t)};u.prototype=Object.create(s.prototype),u.prototype.constructor=u,i(u,["filter","operator","value"]),o.Group=a,o.Rule=u;var p=o.utils={};p.iterateOptions=function(t,r){t&&(e.isArray(t)?t.forEach(function(t){e.isPlainObject(t)?e.each(t,function(e,t){return r(e,t),!1}):r(t,t)}):e.each(t,function(e,t){r(e,t)}))},p.fmt=function(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{([0-9]+)}/g,function(e,r){return t[parseInt(r)]})},p.error=function(e,t){var r=new Error(p.fmt.apply(null,Array.prototype.slice.call(arguments,1)));throw r.name=e+"Error",r.args=Array.prototype.slice.call(arguments,2),r},p.changeType=function(e,t,r){switch(t){case"integer":return parseInt(e);case"double":return parseFloat(e);case"boolean":var i="true"===e.trim().toLowerCase()||"1"===e.trim()||1===e;return r?i?1:0:i;default:return e}},p.escapeString=function(e){return"string"!=typeof e?e:e.replace(/[\0\n\r\b\\\'\"]/g,function(e){switch(e){case"\0":return"\\0";case"\n":return"\\n";case"\r":return"\\r";case"\b":return"\\b";default:return"\\"+e}}).replace(/\t/g,"\\t").replace(/\x1a/g,"\\Z")},p.escapeRegExp=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},p.escapeElementId=function(e){return e?e.replace(/(\\)?([:.\[\],])/g,function(e,t,r){return t?e:"\\"+r}):e},p.groupSort=function(e,t){var r=[],i=[];return e.forEach(function(e){var n;e[t]?-1==(n=r.lastIndexOf(e[t]))?n=r.length:n++:n=r.length,r.splice(n,0,e[t]),i.splice(n,0,e)}),i},e.fn.queryBuilder=function(e){this.length>1&&p.error("Config","Unable to initialize on multiple target");var t=this.data("queryBuilder"),r="object"==typeof e&&e||{};return t||"destroy"!=e?(t||this.data("queryBuilder",new o(this,r)),"string"==typeof e?t[e].apply(t,Array.prototype.slice.call(arguments,1)):this):this},e.fn.queryBuilder.constructor=o,e.fn.queryBuilder.defaults=o.defaults,e.fn.queryBuilder.extend=o.extend,e.fn.queryBuilder.define=o.define,e.fn.queryBuilder.regional=o.regional,o.define("bt-checkbox",function(e){if("glyphicons"==e.font){var t=document.createElement("style");t.innerHTML='.checkbox input[type=checkbox]:checked + label:after {     font-family: "Glyphicons Halflings";     content: "\\e013"; } .checkbox label:after {     padding-left: 4px;     padding-top: 2px;     font-size: 9px; }',document.body.appendChild(t)}this.on("getRuleInput.filter",function(t,r,i){var n=r.filter;if(("radio"===n.input||"checkbox"===n.input)&&!n.plugin){t.value="",n.colors||(n.colors={}),n.color&&(n.colors._def_=n.color);var o=n.vertical?' style="display:block"':"",l=0;p.iterateOptions(n.values,function(r,s){var a=n.colors[r]||n.colors._def_||e.color,u=i+"_"+l++;t.value+="<div"+o+' class="'+n.input+" "+n.input+"-"+a+'">   <input type="'+n.input+'" name="'+i+'" id="'+u+'" value="'+r+'">   <label for="'+u+'">'+s+"</label> </div>"})}})},{font:"glyphicons",color:"default"}),o.define("bt-selectpicker",function(t){e.fn.selectpicker&&e.fn.selectpicker.Constructor||p.error("MissingLibrary",'Bootstrap Select is required to use "bt-selectpicker" plugin. Get it here: http://silviomoreto.github.io/bootstrap-select'),this.on("afterCreateRuleFilters",function(e,r){r.$el.find(l.rule_filter).removeClass("form-control").selectpicker(t)}),this.on("afterCreateRuleOperators",function(e,r){r.$el.find(l.rule_operator).removeClass("form-control").selectpicker(t)}),this.on("afterUpdateRuleFilter",function(e,t){t.$el.find(l.rule_filter).selectpicker("render")}),this.on("afterUpdateRuleOperator",function(e,t){t.$el.find(l.rule_operator).selectpicker("render")})},{container:"body",style:"btn-inverse btn-xs",width:"auto",showIcon:!1}),o.define("bt-tooltip-errors",function(t){e.fn.tooltip&&e.fn.tooltip.Constructor&&e.fn.tooltip.Constructor.prototype.fixTitle||p.error("MissingLibrary",'Bootstrap Tooltip is required to use "bt-tooltip-errors" plugin. Get it here: http://getbootstrap.com');var r=this;this.on("getRuleTemplate.filter getGroupTemplate.filter",function(t){var r=e(t.value);r.find(l.error_container).attr("data-toggle","tooltip"),t.value=r.prop("outerHTML")}),this.model.on("update",function(e,i,n){"error"==n&&r.settings.display_errors&&i.$el.find(l.error_container).eq(0).tooltip(t).tooltip("hide").tooltip("fixTitle")})},{placement:"right"}),o.extend({setFilters:function(e,t){var r=this;void 0===t&&(t=e,e=!1),t=this.checkFilters(t);var i=(t=this.change("setFilters",t)).map(function(e){return e.id});if(e||function e(t){t.each(function(e){e.filter&&-1===i.indexOf(e.filter.id)&&p.error("ChangeFilter",'A rule is using filter "{0}"',e.filter.id)},e)}(this.model.root),this.filters=t,function e(t){t.each(!0,function(e){e.filter&&-1===i.indexOf(e.filter.id)?e.drop():(r.createRuleFilters(e),e.$el.find(l.rule_filter).val(e.filter?e.filter.id:"-1"))},e)}(this.model.root),this.settings.plugins&&(this.settings.plugins["unique-filter"]&&this.updateDisabledFilters(),this.settings.plugins["bt-selectpicker"]&&this.$el.find(l.rule_filter).selectpicker("render")),this.settings.default_filter)try{this.getFilterById(this.settings.default_filter)}catch(e){this.settings.default_filter=null}this.trigger("afterSetFilters",t)},addFilter:function(t,r){void 0===r||"#end"==r?r=this.filters.length:"#start"==r&&(r=0),e.isArray(t)||(t=[t]);var i=e.extend(!0,[],this.filters);parseInt(r)==r?Array.prototype.splice.apply(i,[r,0].concat(t)):this.filters.some(function(e,t){return e.id==r?(r=t+1,!0):void 0})?Array.prototype.splice.apply(i,[r,0].concat(t)):Array.prototype.push.apply(i,t),this.setFilters(i)},removeFilter:function(t,r){var i=e.extend(!0,[],this.filters);"string"==typeof t&&(t=[t]),i=i.filter(function(e){return-1===t.indexOf(e.id)}),this.setFilters(r,i)}}),o.define("filter-description",function(t){"inline"===t.mode?this.on("afterUpdateRuleFilter",function(r,i){var n=i.$el.find("p.filter-description");i.filter&&i.filter.description?(0===n.length?(n=e('<p class="filter-description"></p>')).appendTo(i.$el):n.show(),n.html('<i class="'+t.icon+'"></i> '+i.filter.description)):n.hide()}):"popover"===t.mode?(e.fn.popover&&e.fn.popover.Constructor&&e.fn.popover.Constructor.prototype.fixTitle||p.error("MissingLibrary",'Bootstrap Popover is required to use "filter-description" plugin. Get it here: http://getbootstrap.com'),this.on("afterUpdateRuleFilter",function(r,i){var n=i.$el.find("button.filter-description");i.filter&&i.filter.description?(0===n.length?((n=e('<button type="button" class="btn btn-xs btn-info filter-description" data-toggle="popover"><i class="'+t.icon+'"></i></button>')).prependTo(i.$el.find(l.rule_actions)),n.popover({placement:"left",container:"body",html:!0}),n.on("mouseout",function(){n.popover("hide")})):n.show(),n.data("bs.popover").options.content=i.filter.description,n.attr("aria-describedby")&&n.popover("show")):(n.hide(),n.data("bs.popover")&&n.popover("hide"))})):"bootbox"===t.mode&&("bootbox"in window||p.error("MissingLibrary",'Bootbox is required to use "filter-description" plugin. Get it here: http://bootboxjs.com'),this.on("afterUpdateRuleFilter",function(r,i){var n=i.$el.find("button.filter-description");i.filter&&i.filter.description?(0===n.length&&((n=e('<button type="button" class="btn btn-xs btn-info filter-description" data-toggle="bootbox"><i class="'+t.icon+'"></i></button>')).prependTo(i.$el.find(l.rule_actions)),n.on("click",function(){bootbox.alert(n.data("description"))})),n.data("description",i.filter.description)):n.hide()}))},{icon:"glyphicon glyphicon-info-sign",mode:"popover"}),o.defaults({operatorOpposites:{equal:"not_equal",not_equal:"equal",in:"not_in",not_in:"in",less:"greater_or_equal",less_or_equal:"greater",greater:"less_or_equal",greater_or_equal:"less",between:"not_between",not_between:"between",begins_with:"not_begins_with",not_begins_with:"begins_with",contains:"not_contains",not_contains:"contains",ends_with:"not_ends_with",not_ends_with:"ends_with",is_empty:"is_not_empty",is_not_empty:"is_empty",is_null:"is_not_null",is_not_null:"is_null"},conditionOpposites:{AND:"OR",OR:"AND"}}),o.define("invert",function(t){var i=this;this.on("afterInit",function(){i.$el.on("click.queryBuilder","[data-invert=group]",function(){var n=e(this).closest(l.group_container);i.invert(r(n),t)}),t.display_rules_button&&t.invert_rules&&i.$el.on("click.queryBuilder","[data-invert=rule]",function(){var n=e(this).closest(l.rule_container);i.invert(r(n),t)})}),this.on("getGroupTemplate.filter",function(r,n){var o=e(r.value);o.find(l.condition_container).after('<button type="button" class="btn btn-xs btn-default" data-invert="group"><i class="'+t.icon+'"></i> '+i.lang.invert+"</button>"),r.value=o.prop("outerHTML")}),t.display_rules_button&&t.invert_rules&&this.on("getRuleTemplate.filter",function(r){var n=e(r.value);n.find(l.rule_actions).prepend('<button type="button" class="btn btn-xs btn-default" data-invert="rule"><i class="'+t.icon+'"></i> '+i.lang.invert+"</button>"),r.value=n.prop("outerHTML")})},{icon:"glyphicon glyphicon-random",recursive:!0,invert_rules:!0,display_rules_button:!1,silent_fail:!1}),o.extend({invert:function(t,r){if(!(t instanceof s)){if(!this.model.root)return;r=t,t=this.model.root}if("object"!=typeof r&&(r={}),void 0===r.recursive&&(r.recursive=!0),void 0===r.invert_rules&&(r.invert_rules=!0),void 0===r.silent_fail&&(r.silent_fail=!1),void 0===r.trigger&&(r.trigger=!0),t instanceof a){if(this.settings.conditionOpposites[t.condition]?t.condition=this.settings.conditionOpposites[t.condition]:r.silent_fail||p.error("InvertCondition",'Unknown inverse of condition "{0}"',t.condition),r.recursive){var i=e.extend({},r,{trigger:!1});t.each(function(e){r.invert_rules&&this.invert(e,i)},function(e){this.invert(e,i)},this)}}else if(t instanceof u&&t.operator&&!t.filter.no_invert)if(this.settings.operatorOpposites[t.operator.type]){var n=this.settings.operatorOpposites[t.operator.type];t.filter.operators&&-1==t.filter.operators.indexOf(n)||(t.operator=this.getOperatorByType(n))}else r.silent_fail||p.error("InvertOperator",'Unknown inverse of operator "{0}"',t.operator.type);r.trigger&&this.trigger("afterInvert",t,r)}}),o.defaults({mongoOperators:{equal:function(e){return e[0]},not_equal:function(e){return{$ne:e[0]}},in:function(e){return{$in:e}},not_in:function(e){return{$nin:e}},less:function(e){return{$lt:e[0]}},less_or_equal:function(e){return{$lte:e[0]}},greater:function(e){return{$gt:e[0]}},greater_or_equal:function(e){return{$gte:e[0]}},between:function(e){return{$gte:e[0],$lte:e[1]}},not_between:function(e){return{$lt:e[0],$gt:e[1]}},begins_with:function(e){return{$regex:"^"+p.escapeRegExp(e[0])}},not_begins_with:function(e){return{$regex:"^(?!"+p.escapeRegExp(e[0])+")"}},contains:function(e){return{$regex:p.escapeRegExp(e[0])}},not_contains:function(e){return{$regex:"^((?!"+p.escapeRegExp(e[0])+").)*$",$options:"s"}},ends_with:function(e){return{$regex:p.escapeRegExp(e[0])+"$"}},not_ends_with:function(e){return{$regex:"(?<!"+p.escapeRegExp(e[0])+")$"}},is_empty:function(e){return""},is_not_empty:function(e){return{$ne:""}},is_null:function(e){return null},is_not_null:function(e){return{$ne:null}}},mongoRuleOperators:{$ne:function(e){return{val:e=e.$ne,op:null===e?"is_not_null":""===e?"is_not_empty":"not_equal"}},eq:function(e){return{val:e,op:null===e?"is_null":""===e?"is_empty":"equal"}},$regex:function(e){return"^(?!"==(e=e.$regex).slice(0,4)&&")"==e.slice(-1)?{val:e.slice(4,-1),op:"not_begins_with"}:"^((?!"==e.slice(0,5)&&").)*$"==e.slice(-5)?{val:e.slice(5,-5),op:"not_contains"}:"(?<!"==e.slice(0,4)&&")$"==e.slice(-2)?{val:e.slice(4,-2),op:"not_ends_with"}:"$"==e.slice(-1)?{val:e.slice(0,-1),op:"ends_with"}:"^"==e.slice(0,1)?{val:e.slice(1),op:"begins_with"}:{val:e,op:"contains"}},between:function(e){return{val:[e.$gte,e.$lte],op:"between"}},not_between:function(e){return{val:[e.$lt,e.$gt],op:"not_between"}},$in:function(e){return{val:e.$in,op:"in"}},$nin:function(e){return{val:e.$nin,op:"not_in"}},$lt:function(e){return{val:e.$lt,op:"less"}},$lte:function(e){return{val:e.$lte,op:"less_or_equal"}},$gt:function(e){return{val:e.$gt,op:"greater"}},$gte:function(e){return{val:e.$gte,op:"greater_or_equal"}}}}),l.rule_and_group_containers=l.rule_container+", "+l.group_container,o.define("sortable",function(t){this.on("afterInit",function(t){e.event.props.push("dataTransfer");var i,o,s=t.builder;s.$el.on("mouseover.queryBuilder",".drag-handle",function(){s.$el.find(l.rule_and_group_containers).attr("draggable",!0)}),s.$el.on("mouseout.queryBuilder",".drag-handle",function(){s.$el.find(l.rule_and_group_containers).removeAttr("draggable")}),s.$el.on("dragstart.queryBuilder","[draggable]",function(t){t.stopPropagation(),t.dataTransfer.setData("text","drag"),o=r(t.target),setTimeout(function(){var t=e('<div class="rule-placeholder">&nbsp;</div>');t.css("min-height",o.$el.height()),i=o.parent.addRule(t,o.getPos()),o.$el.hide()},0)}),s.$el.on("dragenter.queryBuilder","[draggable]",function(t){t.preventDefault(),t.stopPropagation(),i&&n(i,e(t.target))}),s.$el.on("dragover.queryBuilder","[draggable]",function(e){e.preventDefault(),e.stopPropagation()}),s.$el.on("drop.queryBuilder",function(t){t.preventDefault(),t.stopPropagation(),n(o,e(t.target))}),s.$el.on("dragend.queryBuilder","[draggable]",function(e){e.preventDefault(),e.stopPropagation(),o.$el.show(),i.drop(),s.$el.find(l.rule_and_group_containers).removeAttr("draggable"),s.trigger("afterMove",o),o=i=null})}),this.on("parseRuleFlags.filter",function(e){void 0===e.value.no_sortable&&(e.value.no_sortable=t.default_no_sortable)}),this.on("afterApplyRuleFlags",function(e,t){t.flags.no_sortable&&t.$el.find(".drag-handle").remove()}),this.on("parseGroupFlags.filter",function(e){void 0===e.value.no_sortable&&(e.value.no_sortable=t.default_no_sortable)}),this.on("afterApplyGroupFlags",function(e,t){t.flags.no_sortable&&t.$el.find(".drag-handle").remove()}),this.on("getGroupTemplate.filter",function(r,i){if(i>1){var n=e(r.value);n.find(l.condition_container).after('<div class="drag-handle"><i class="'+t.icon+'"></i></div>'),r.value=n.prop("outerHTML")}}),this.on("getRuleTemplate.filter",function(r){var i=e(r.value);i.find(l.rule_header).after('<div class="drag-handle"><i class="'+t.icon+'"></i></div>'),r.value=i.prop("outerHTML")})},{default_no_sortable:!1,icon:"glyphicon glyphicon-sort"}),o.define("unique-filter",function(){this.status.used_filters={},this.on("afterUpdateRuleFilter",this.updateDisabledFilters),this.on("afterDeleteRule",this.updateDisabledFilters),this.on("afterCreateRuleFilters",this.applyDisabledFilters),this.on("afterReset",this.clearDisabledFilters),this.on("afterClear",this.clearDisabledFilters)}),o.extend({updateDisabledFilters:function(e){var t=e?e.builder:this;t.status.used_filters={},t.model&&(function e(r){r.each(function(e){e.filter&&e.filter.unique&&(t.status.used_filters[e.filter.id]||(t.status.used_filters[e.filter.id]=[]),"group"==e.filter.unique&&t.status.used_filters[e.filter.id].push(e.parent))},function(t){e(t)})}(t.model.root),t.applyDisabledFilters(e))},clearDisabledFilters:function(e){var t=e?e.builder:this;t.status.used_filters={},t.applyDisabledFilters(e)},applyDisabledFilters:function(t){var r=t?t.builder:this;r.$el.find(l.filter_container+" option").prop("disabled",!1),e.each(r.status.used_filters,function(e,t){0===t.length?r.$el.find(l.filter_container+' option[value="'+e+'"]:not(:selected)').prop("disabled",!0):t.forEach(function(t){t.each(function(t){t.$el.find(l.filter_container+' option[value="'+e+'"]:not(:selected)').prop("disabled",!0)})})}),r.settings.plugins&&r.settings.plugins["bt-selectpicker"]&&r.$el.find(l.rule_filter).selectpicker("render")}}),o.regional.en={__locale:"English (en)",__author:'Damien "Mistic" Sorel, http://www.strangeplanet.fr',add_rule:"Add rule",add_group:"Add group",delete_rule:"Delete",delete_group:"Delete",conditions:{AND:"AND",OR:"OR"},operators:{equal:"equal",not_equal:"not equal",in:"in",not_in:"not in",less:"less",less_or_equal:"less or equal",greater:"greater",greater_or_equal:"greater or equal",between:"between",not_between:"not between",begins_with:"begins with",not_begins_with:"doesn't begin with",contains:"contains",not_contains:"doesn't contain",ends_with:"ends with",not_ends_with:"doesn't end with",is_empty:"is empty",is_not_empty:"is not empty",is_null:"is null",is_not_null:"is not null"},errors:{no_filter:"No filter selected",empty_group:"The group is empty",radio_empty:"No value selected",checkbox_empty:"No value selected",select_empty:"No value selected",string_empty:"Empty value",string_exceed_min_length:"Must contain at least {0} characters",string_exceed_max_length:"Must not contain more than {0} characters",string_invalid_format:"Invalid format ({0})",number_nan:"Not a number",number_not_integer:"Not an integer",number_not_double:"Not a real number",number_exceed_min:"Must be greater than {0}",number_exceed_max:"Must be lower than {0}",number_wrong_step:"Must be a multiple of {0}",datetime_empty:"Empty value",datetime_invalid:"Invalid date format ({0})",datetime_exceed_min:"Must be after {0}",datetime_exceed_max:"Must be before {0}",boolean_not_valid:"Not a boolean",operator_not_multiple:"Operator {0} cannot accept multiple values"},invert:"Invert"},o.defaults({lang_code:"en"})});
